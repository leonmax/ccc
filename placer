os.loadAPI("task")
os.loadAPI("slotmgr")

local Placer = {}
Placer.__index = Placer

function Placer.new(slot)
  local self = setmetatable({}, Placer)
  slotmgr.select(1)
  return self
end

function Placer.placeDown(self)
  local success = turtle.placeDown(1)
  if success then
    print("placed a block below")
  end
  return success
end

function Placer.act(self)
  if not turtle.detectDown() then
    while not self:placeDown() do
      if not slotmgr.reloadSlot() then
        break
      end
    end
  end
end

local arg = { ... }
if #arg < 2 then
  print("Usage: placer <width> <distance> [<slotnum>]")
end

local slot = 0
local w = tonumber(arg[1])
local d = tonumber(arg[2])
if #arg == 3 then
  slot = tonumber(arg[3])
end
local actor = Placer.new(slot)
task.Task.new(actor):cover(w, d)
